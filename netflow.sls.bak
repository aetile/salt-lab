test 1:
  cmd.run:
    - name: echo hostname={{ grains['host'] }}

{% set hostname = grains['host'] %}
test 2:
  cmd.run:
    - name: echo set hostname

{% set targets = salt['pillar.get']('netflow') %}
test 3:
  cmd.run:
    - name: echo targets={{ targets | join(',') }}

{% for socket in targets %}
Echo {{ socket }} {{ targets[socket][0] }}:
  cmd.run:
    - name: echo host={{ targets[socket][0] }} port={{ targets[socket][1] }}
Port opening from {{ socket }} to {{ targets[socket][0] }} {{ targets[socket][1] }} :
  cmd.run:
    - name: telnet {{ targets[socket][0] }} {{ targets[socket][1] }}
  module.run:
    - name: network.connect
    - host: {{ targets[socket][0] }}
    - port: {{ targets[socket][1] }}
{% endfor %}
